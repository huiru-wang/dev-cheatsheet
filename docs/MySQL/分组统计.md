# 分组统计


## 分组后组内统计
```sql
SELECT t.app, count(t.user_id) AS `userCount`, 
COUNT(CASE WHEN t.type = 'normal' THEN 1 END) AS `normalCount`,
COUNT(CASE WHEN t.type IN ('vip', 'vvip') THEN 1 END) AS `vipCount`
FROM t_fault_alert_relation 
WHERE occur_time >= '2023-08-10T20:37:21' AND occur_time <= '2023-08-11T08:36:04' AND app IS NOT NULL
GROUP BY t.app
HAVING userCount > 10
ORDER BY userCount DESC;
```


## 分组后组内去重统计
1、子查询先查询出去重后的数据；

2、再分组；
```sql
SELECT t.app, count(t.user_id) AS `userCount`, 
COUNT(CASE WHEN t.type = 'normal' THEN 1 END) AS `normalCount`,
COUNT(CASE WHEN t.type IN ('vip', 'vvip') THEN 1 END) AS `vipCount`
FROM (
	SELECT DISTINCT user_id, type, app FROM t_fault_alert_relation 
	WHERE occur_time >= '2023-08-10T20:37:21' AND occur_time <= '2023-08-11T08:36:04' AND app IS NOT NULL
) t
GROUP BY t.app
HAVING userCount > 10
ORDER BY userCount DESC;
```
